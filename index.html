<html>
  <head>
    <title> Code Pair </title>
    <style>
        #code {
          width: 100%;
          height: 100%;
          font-family: "Monospace";
          font-size: 12;
          border: none;
          color: #FFFFFF;
          background-color: #000000;
        }
        #nums {
          font-family: "Monospace";
          font-size: 12;
          color: #FFFFFF;
          background-color: #000000;
        }
        #run {
          width: 25%;
          font-family: "Monospace";
          font-size: 12;
          color: #FFFFFF;
          background-color: #000000;
          border-left: 1px solid #FFFFFF;
          padding-left: 10px;
        }

        .text {
          font-family: "Monospace";
          font-size: 12;
          color: #FFFFFF;
        }

        #runbutton {
          font-family: "Monospace";
          font-size: 12;
          color: #FFFFFF;
          border: 1px #FFFFFF solid;
          background-color: #000000;
        }
    </style>

    <script src="/socket.io/socket.io.js"></script>

    <script>

      var lastlen = 0;

      var socket = io.connect();
      socket.on('connect', function(data) {
        socket.emit('get', '')
      });
      socket.on('file', function(data) {
        document.getElementById("code").value = data
        lastlen = data.length
      });
      socket.on('update', function(data) {
        console.log(data)
        var code = document.getElementById("code")
        if (!data.backspace) {
          code.value += data.value
        } else {
          code.value = code.value.slice(0, -1)
        }
        lastlen = data.value
        number();
      });

      function number() {
        var code = document.getElementById("code")
        var numbering = document.getElementById("nums")
        var lines = code.value.split("\n").length
        numbering.innerHTML = ""
        for (i = 0; i < lines; i++) {
          numbering.innerHTML += "" + (i + 1) + ". <br/>"
        }
      }

      function onTyped() {
        var code = document.getElementById("code")
        number();
        socket.emit('edit', {
          backspace: code.value.length < lastlen,
          value: code.value[code.value.length-1]
        })
        lastlen = code.value.length
      }

    </script>

  </head>
  <body bgcolor=#000000>

    <table width=100% height=100%>

      <tr border=1>
        <td valign=top style="width: 30px" id=nums>1.</td>
        <td valign=top ><textarea id=code oninput="javascript:onTyped()"></textarea></td>
        <td valign=top id=run>
          <table width=100%>
            <tr>
              <td width=100% class=text>Output:</td>
              <td><button type=button id=runbutton>Run</button></td>
            </tr>
          </table>
          <hr>
        </td>
      </tr>

    </table>

  </body>
</html>
